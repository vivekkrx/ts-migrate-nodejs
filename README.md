# ts-migrate-nodejs

Migrate nodejs codebase to typescript. Step by step guide.

### Current Folder Structure

```bash
.
├── node_modules
├── src
│   └── utils
│       └──index.js
├── .gitignore
├── index.js
├── package-lock.json
└── package.json
```

### Install `typescript`

```bash
npm i -D typescript
```

### Add `tsconfig` file

```bash
npx tsc --init
```

### Configure `ts`

Add `"allowJs": true`, `"outDir": "./dist"`, `"moduleResolution": "node"`, `"noImplicitAny": true`, `"esModuleInterop": true` to `tsconfig.json` file.

### Include source for `.ts` files

```json
"include": ["src", "index.ts", "@types"]
/* Add all the folders/files that contains ts files */
```

### Rename the `.js` files to `.ts`

Rename the javascript files extension to `.ts` and start adding types. You can do it increamentally too, file by file.

### Create `@types/global.d.ts` file (optional)

Add a **global types file** that contains all the globally defined types. This way you can directly add types that were defined here in other `ts` files without importing it.

### Install `@types/node`

```bash
npm i -D @types/node
```

This installs types for `node`. You also need to install types for any third-party library/framework you are using. For eg, I use `express`, hence I need to install types for `express`.

```bash
npm i -D @types/express
```

If you dont't find types for a library, your can add `@types/declarations.d.ts` file and declare a module.

```typescript
declare module '<name-of-the-library>'
// You can declare and define types of the library
```

### Adding scripts

Add the following scripts the `package.json` file.

```json
 "scripts": {
    /* Rest of the scripts */
    "build": "tsc -p tsconfig.json",
    "start": "node dist/index.js",
    /* Rest of the scripts */
  },
```

By running `npm run build`, `typescript` will transpile all the `.ts` files to `.js` files and put them in `dist` folder, and by running `npm run start`, `node` will run `dist/index.js` file that was generated by `typescript`.

_Now your project is up and running!_

But there is a problem, everytime you make the changes to your codebase you have to run `npm run build` and `npm run start` to run the file with latest changes.

_Not to worry. Continue reading._

### Install `ts-node`

```bash
npm i -D ts-node
```

`ts-node` is a JIT transpiler that lets you run `typescript` on top of `node`. So you can directly run `ts-node ./index.ts` wihtout transpiling `ts` to `js`.

_But wait, you still need to run this command everytime you make changes to your codebase._

### Install `nodemon`

```bash
npm i -D nodemon
```

`nodemon` is a tool that automatically restarts `node` whenever it detects changes in the codebase. For eg, `nodemon index.js` would watch the files and restart `node` whenever you edit `index.js` or any other associated file.

### Add `dev` script

This is the last step of the process where in we will add the `dev` script to `package.json`. Add the following to your `package.json`.

```json
 "scripts": {
    /* Rest of the scripts */
    "dev": "nodemon --exec npx ts-node --files ./index.ts",
    /* Rest of the scripts */
  },
```

Now `npm run dev` will start `nodemon` which restarts `ts-node` whenever it detects changes in the codebase.

_Happy node-ing!_
